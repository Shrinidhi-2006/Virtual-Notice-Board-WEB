<div class="notice-container">
  <div class="page-header">
    <h3>üìã Notice Board</h3>
    <p>Stay informed with the latest updates</p>
  </div>

  <!-- Admin Filter Section -->
  <div *ngIf="isAdmin || isTeacher" class="filter-section">
    <div class="filter-row">
      <!-- User Filter (still regular dropdown for simplicity) -->
      <div class="form-group">
        <label>User</label>
        <div class="custom-dropdown" (click)="toggleUserDropdown()">
          <span>{{ selectedUser || 'Select User' }}</span>
          <ul *ngIf="userDropdownOpen" class="dropdown-list">
            <li *ngFor="let user of teachersAndAdmins" (click)="selectUser(user.username, $event)">
              {{ user.username }}
            </li>
          </ul>
        </div>
      </div>

      <!-- Year Filter (custom dropdown) -->
      <div class="form-group">
        <label>Year</label>
        <div class="custom-dropdown" (click)="toggleYearDropdown()">
          <span>
            {{
            selectedYear !== null && selectedYear !== undefined
            ? getYearLabel(selectedYear)
            : 'Select Year'
            }}
          </span>
          <ul *ngIf="yearDropdownOpen" class="dropdown-list">
            <li *ngFor="let yr of years" (click)="selectYear(yr, $event)">
              {{ yr.yearName }}
            </li>

          </ul>
        </div>
      </div>

      <!-- Uploaded Year Filter -->
      <div class="form-group">
        <label>Uploaded Year</label>
        <div class="custom-dropdown" (click)="toggleUploadedYearDropdown()">
          <span>
            {{ selectedUploadedYear || 'Select Uploaded Year' }}
          </span>
          <ul *ngIf="uploadedYearDropdownOpen" class="dropdown-list">
            <li *ngFor="let y of uploadedYears" (click)="selectUploadedYear(y, $event)">
              {{ y }}
            </li>
          </ul>
        </div>
      </div>

      <!-- Department Filter -->
      <div class="form-group">
        <label>Department</label>
        <div class="custom-dropdown" (click)="toggleDepartmentDropdown()">
          <span>{{ selectedDepartment || 'Select Department' }}</span>
          <ul *ngIf="departmentDropdownOpen" class="dropdown-list">
            <li *ngFor="let dept of departments" (click)="selectDepartment(dept, $event)">
              {{ dept.name }}
            </li>

          </ul>
        </div>
      </div>

      <button (click)="applyFilters()" class="filter-btn">Apply Filters</button>
      <button (click)="resetFilters()" class="reset-btn">Reset</button>
    </div>
  </div>

  <!-- Student Filter Section -->
  <div *ngIf="!isAdmin && !isTeacher" class="filter-section">
    <div class="filter-row">
      <!-- User Filter -->
      <div class="form-group">
        <label>Posted By</label>
        <div class="custom-dropdown" (click)="toggleUserDropdown()">
          <span>{{ selectedUser || 'Select User' }}</span>
          <ul *ngIf="userDropdownOpen" class="dropdown-list">
            <li *ngFor="let user of teachersAndAdmins" (click)="selectUser(user.username, $event)">
              {{ user.username }}
            </li>
          </ul>
        </div>
      </div>

      <!-- Uploaded Year Filter -->
      <div class="form-group">
        <label>Uploaded Year</label>
        <div class="custom-dropdown" (click)="toggleUploadedYearDropdown()">
          <span>{{ selectedUploadedYear || 'Select Uploaded Year' }}</span>
          <ul *ngIf="uploadedYearDropdownOpen" class="dropdown-list">
            <li *ngFor="let y of uploadedYears" (click)="selectUploadedYear(y, $event)">
              {{ y }}
            </li>
          </ul>
        </div>
      </div>

      <button (click)="applyFilters()" class="filter-btn">Apply Filters</button>
      <button (click)="resetFilters()" class="reset-btn">Reset</button>
    </div>
  </div>

  <div class="notices-grid" *ngIf="(notices?.length ?? 0) > 0">
    <div *ngFor="let notice of notices" class="notice-card" [class.expired-card]="isExpired(notice.expiryDate)">

      <div class="notice-header">
        <h4>{{ notice?.title }}</h4>
      </div>

      <p>{{ notice?.description }}</p>

      <div class="badge-container">

        <!-- Department Badge -->
        <small *ngIf="notice?.department" class="badge badge-department">
          {{ notice?.department }}
        </small>

        <!-- Year Badge -->
        <small *ngIf="notice?.year" class="badge badge-year">
          {{ notice?.year }}
        </small>

        <!-- EXPIRES SOON -->
        <small *ngIf="isExpiringSoon(notice.expiryDate) && !isExpired(notice.expiryDate)"
          class="badge expiring-soon-badge">
          ‚è≥ Expires Soon
        </small>

        <!-- EXPIRED (Admin/Teacher Only) -->
        <small *ngIf="(isAdmin || isTeacher) && isExpired(notice.expiryDate)" class="badge expired-badge">
          ‚ö† Expired
        </small>

      </div>

      <div *ngIf="notice?.imagePaths?.length" class="image-container">
        <ng-container *ngFor="let file of notice.imagePaths">

          <!-- If Image -->
          <img *ngIf="isImage(file)" [src]="file" alt="Image" class="notice-image" (click)="openImageInNewTab(file)" />

          <!-- If PDF -->
          <div *ngIf="isPDF(file)" class="pdf-preview-box" (click)="openPDF(file)">
            <img src="assets/PDF.png" class="pdf-icon" />
          </div>

        </ng-container>
      </div>

      <div class="notice-meta">
        <span>Posted by <span class="posted-by">{{ notice?.postedBy }}</span></span>
        <span>{{ notice?.postedDate | date:'medium' }}</span>
      </div>

      <button *ngIf="canEditNotice(notice)" (click)="editNotice(notice)" class="notice-action-btn edit-btn">
        ‚úèÔ∏è Edit Notice
      </button>

      <button *ngIf="canDeleteNotice(notice)" (click)="deleteNotice(notice.id)" class="notice-action-btn delete-btn">
        üóëÔ∏è Delete Notice
      </button>

    </div>
  </div>

  <div *ngIf="notices?.length === 0" class="no-notices">
    <div class="no-notices-icon">üì≠</div>
    <p>No notices available at the moment.</p>
  </div>

  <!-- Pagination Controls -->
  <div *ngIf="totalPages > 1" class="pagination-container">
    <button class="page-btn" [disabled]="currentPage === 0" (click)="previousPage()">‚¨Ö Prev</button>

    <button *ngFor="let page of [].constructor(totalPages); let i = index" class="page-number"
      [class.active]="i === currentPage" (click)="goToPage(i)">
      {{ i + 1 }}
    </button>

    <button class="page-btn" [disabled]="currentPage === totalPages - 1" (click)="nextPage()">Next ‚û°</button>
  </div>

</div>